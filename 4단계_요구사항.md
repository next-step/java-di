# ğŸš€ 4ë‹¨ê³„ - @Configuration êµ¬í˜„í•˜ê¸°(íŒíŠ¸)

### **ì„¤ì • íŒŒì¼ì„ ì½ì–´ Bean ë“±ë¡ ê¸°ëŠ¥ ì¶”ê°€**

- ë‹¤ìŒê³¼ ê°™ì€ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì½”ë“œ ë§Œë“¤ì–´ passí•˜ë„ë¡ êµ¬í˜„í•œë‹¤.

```java
public class ConfigurationBeanScannerTest {
    @Test
    public void register_simple() {
        BeanFactory beanFactory = new BeanFactory();
        ConfigurationBeanScanner cbs = new ConfigurationBeanScanner(beanFactory);
        cbs.register(ExampleConfig.class);
        beanFactory.initialize();

        assertNotNull(beanFactory.getBean(DataSource.class));
    }
}

```

- ìœ„ í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œ ì‚¬ìš©í•œ ExampleConfigëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

```java
@Configuration
public class ExampleConfig {
    @Bean
    public DataSource dataSource() {
        final var jdbcDataSource = new JdbcDataSource();
        jdbcDataSource.setUrl("jdbc:h2:mem:test;DB_CLOSE_DELAY=-1;");
        jdbcDataSource.setUser("");
        jdbcDataSource.setPassword("");
        return jdbcDataSource;
    }
}

```

### **ì„¤ì • íŒŒì¼ì„ í†µí•´ ë“±ë¡í•œ Beanê³¼ ClasspathBeanScannerë¥¼ í†µí•´ ì¶”ê°€í•œ Bean í†µí•©**

- DI 1ë‹¨ê³„ì—ì„œ êµ¬í˜„í•œ BeanSannerë¥¼ ClasspathBeanSacnnerë¡œ ë³€ê²½í•˜ê³  ì„¤ì • íŒŒì¼ë¡œ ë“±ë¡í•œ Beanê³¼ í†µí•©í•œë‹¤.
- ê° Scannerë¥¼ í†µí•´ ìƒì„±í•œ Bean ê°„ì—ë„ ì˜ì¡´ê´€ê³„ë¥¼ ê°€ì ¸ì•¼í•˜ê¸° ë•Œë¬¸ì— BeanFactoryë¥¼ ê° Scannerì— ì „ë‹¬í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì€ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì¶”ê°€í•´ êµ¬í˜„í•œë‹¤.

```java
public class ConfigurationBeanScannerTest {
    @Test
    public void register_classpathBeanScanner_í†µí•©() {
        BeanFactory beanFactory = new BeanFactory();
        ConfigurationBeanScanner cbs = new ConfigurationBeanScanner(beanFactory);
        cbs.register(IntegrationConfig.class);

        ClasspathBeanScanner cbds = new ClasspathBeanScanner(beanFactory);
        cbds.doScan("samples");
        beanFactory.initialize();

        assertNotNull(beanFactory.getBean(DataSource.class));

        JdbcSampleRepository sampleRepository = beanFactory.getBean(JdbcSampleRepository.class);
        assertNotNull(sampleRepository);
        assertNotNull(sampleRepository.getDataSource());

        JdbcTemplate jdbcTemplate = beanFactory.getBean(JdbcTemplate.class);
        assertNotNull(jdbcTemplate);
        assertNotNull(jdbcTemplate.getDataSource());
    }
}

```

- ìœ„ í…ŒìŠ¤íŠ¸ ì½”ë“œì—ì„œ ì‚¬ìš©í•œ IntegrationConfigëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

```java
@Configuration
public class IntegrationConfig {
    @Bean
    public DataSource dataSource() {
        final var jdbcDataSource = new JdbcDataSource();
        jdbcDataSource.setUrl("jdbc:h2:mem:test;DB_CLOSE_DELAY=-1;");
        jdbcDataSource.setUser("");
        jdbcDataSource.setPassword("");
        return jdbcDataSource;
    }

    @Bean
    public JdbcTemplate jdbcTemplate(DataSource dataSource) {
        return new JdbcTemplate(dataSource);
    }
}

```

### **ConfigurationBeanScannerì™€ ClasspathBeanScannerì„ í†µí•©í•˜ëŠ” í´ë˜ìŠ¤ ì¶”ê°€**

- ConfigurationBeanScannerì™€ ClasspathBeanScannerì„ ë§¤ë²ˆ ìˆ˜ë™ìœ¼ë¡œ í†µí•©í•˜ëŠ” ê²ƒë³´ë‹¤ëŠ” ë‘˜ì˜ í†µí•©ì„ ë‹´ë‹¹í•˜ëŠ” ìƒˆë¡œìš´ í´ë˜ìŠ¤ë¥¼ ApplicationContextë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì¶”ê°€í•œë‹¤.
- ApplicationContextì—ì„œëŠ” ì„¤ì • íŒŒì¼ì„ ì „ë‹¬ ë°›ì€ í›„ @ComponentScan ì• ë…¸í…Œì´ì…˜ì˜ ê²½ë¡œ ì •ë³´ë¥¼ ê°€ì ¸ì™€ ClasspathBeanScannerì„ ì´ˆê¸°í™” í•˜ê³ , ì„¤ì • íŒŒì¼ì˜ @Bean ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ConfigurationBeanScannerì„ ì´ˆê¸°í™”í•˜ëŠ” ì—­í• ì„ ë‹´ë‹¹í•œë‹¤.
- ë‹¤ìŒê³¼ ê°™ì´ ApplicationContextë¥¼ ì´ˆê¸°í™”í•œ í›„ AnnotationHandlerMappingì—ì„œ ApplicationContextì„ ì‚¬ìš©í•´ ì´ˆê¸°í™”ê°€ ê°€ëŠ¥í•˜ë„ë¡ í†µí•©í•  ìˆ˜ ìˆë‹¤.
```java
ApplicationContext ac = new ApplicationContext(MyConfiguration.class);
AnnotationHandlerMapping ahm = new AnnotationHandlerMapping(ac);
ahm.initialize();
```

---
### ìš”êµ¬ì‚¬í•­ ì •ë¦¬

[x] ì„¤ì •íŒŒì¼ì„ ì½ì–´ ë¹ˆì„ ë“±ë¡í•˜ëŠ” ê¸°ëŠ¥ì„ ì¶”ê°€í•œë‹¤
[x] ê° Scannerë¥¼ í†µí•´ ìƒì„±í•œ Bean ê°„ì—ë„ ì˜ì¡´ê´€ê³„ë¥¼ ê°€ì ¸ì•¼í•˜ê¸° ë•Œë¬¸ì— BeanFactoryë¥¼ ê° Scannerì— ì „ë‹¬í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì€ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì¶”ê°€í•´ êµ¬í˜„í•œë‹¤.
[ ] ConfigurationBeanScannerì™€ ClasspathBeanScannerì„ í†µí•©í•˜ëŠ” í´ë˜ìŠ¤ ì¶”ê°€